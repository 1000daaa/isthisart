(function(e,c,a){var d=a.documentElement;e.fn.photoLoader=function(){e.PhotoLoader.init(this);return this};var b=e.PhotoLoader={url:"/api/photos.json",page:1,count:50,enable:true,remainHeight:2000,init:function(k){var f,h=0,l="Now Loading...",j,g="";b.rootNode=e("<ul></ul>");f=b.rootNode[0];while(j=l.charAt(h++)){g+=j===" "?j:"<span>"+j+"</span>"}b.loadingNode=e('<p class="nowLoading">'+g+"</p>");e(k).append(b.rootNode,b.loadingNode);b.listNodes=f.getElementsByTagName("li");b.imageNodes=f.getElementsByTagName("img");b.rootNode.delegate("a","click.PhotoLoader",function(){c.open(this.href,null);return false});e(c).bind("scroll.PhotoLoader",function(){b.scrollHandler()}).trigger("scroll.PhotoLoader")},scrollHandler:function(){var f=Math.max(d.scrollHeight,a.body.scrollHeight)-d.clientHeight-(c.pageYOffset||d.scrollTop);if(b.enable&&b.page&&f<=b.remainHeight){b.request()}b.evacuator()},request:function(){if(!b.enable){return false}b.enable=false;b.loadingNode.show();e.ajax({dataType:"json",url:b.url,data:{page:b.page,count:b.count},success:function(f){b.success(f);b.enable=true},error:function(){b.error()}})},success:function(g){var m=a.createDocumentFragment(),f=0,k=g.data.length,l,j,h;while(f<k){l=g.data[f++];j=a.createElement("li");h=l.filter?l.filter.replace(/\s/g,"-"):"";j.innerHTML=['<a href="'+l.url+'">','<img src="'+l.low+'" data-src="'+l.low+'" class="'+h+'" alt="">',"</a>"].join("");m.appendChild(j)}b.loadingNode.hide();b.rootNode[0].appendChild(m);b.page=g.next},error:function(){},dummySrc:"data:image/gif;,",evacuator:function(){b.isScroll=true;if(b._scrollTimerId){clearTimeout(b._scrollTimerId);b._scrollTimerId=null}b._scrollTimerId=setTimeout(function(){b.isScroll=false;b._evacuator()},300)},_evacuator:function(){var g=c.pageYOffset||d.scrollTop,m=g+d.clientHeight,l=b.listNodes.length,j=0,f,h,n,k;for(;j<l;++j){if(!b.enable){return}f=b.listNodes[j];h=b.imageNodes[j];n=h.getAttribute("src");k=Math.abs(f.getBoundingClientRect().top)>50000;if(n!==b.dummySrc&&k){h.setAttribute("style","display: none");h.setAttribute("src",b.dummySrc)}if(n===b.dummySrc&&!k){h.setAttribute("src",h.getAttribute("data-src"));h.setAttribute("style","display: inline")}}}}})(jQuery,this,document);